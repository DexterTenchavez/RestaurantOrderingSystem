@model RestaurantOrderingSystem.Models.UserDashboardViewModel
@{
    ViewData["Title"] = "My Dashboard";
}

@section Styles {
    <link rel="stylesheet" href="~/css/dashboard.css" asp-append-version="true" />
}

<div class="container-fluid py-4">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card welcome-card">
                <div class="card-body">
                    <div class="welcome-content">
                        <div class="welcome-text">
                            <h2>Welcome back, @Model.User.FullName! 👋</h2>
                            <p>Manage your orders and table reservations</p>
                        </div>
                        <div class="welcome-actions">
                            <a href="@Url.Action("CreateOrder", "Home")" class="btn btn-primary btn-lg">
                                <i class="fas fa-plus me-2"></i>New Order
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-shopping-cart stat-icon"></i>
                    <h3>@Model.Orders.Count</h3>
                    <p>Total Orders</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-table stat-icon"></i>
                    <h3>@Model.Orders.Count(o => o.TableReservation != null)</h3>
                    <p>Table Reservations</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <i class="fas fa-clock stat-icon"></i>
                    <h3>@Model.Orders.Count(o => o.Status == "Pending" || o.Status == "Confirmed")</h3>
                    <p>Active Orders</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Search & Filter</h5>
                </div>
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Search</label>
                            <input type="text" class="form-control" name="search" value="@Model.SearchTerm" placeholder="Search orders, items...">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status">
                                <option value="all">All Status</option>
                                <option value="Pending" selected="@(Model.StatusFilter == "Pending")">Pending</option>
                                <option value="Confirmed" selected="@(Model.StatusFilter == "Confirmed")">Confirmed</option>
                                <option value="Preparing" selected="@(Model.StatusFilter == "Preparing")">Preparing</option>
                                <option value="Ready" selected="@(Model.StatusFilter == "Ready")">Ready</option>
                                <option value="Completed" selected="@(Model.StatusFilter == "Completed")">Completed</option>
                                <option value="Cancelled" selected="@(Model.StatusFilter == "Cancelled")">Cancelled</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Date Range</label>
                            <select class="form-select" name="dateFilter">
                                <option value="">All Dates</option>
                                <option value="today" selected="@(Model.DateFilter == "today")">Today</option>
                                <option value="week" selected="@(Model.DateFilter == "week")">Last 7 Days</option>
                                <option value="month" selected="@(Model.DateFilter == "month")">Last 30 Days</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Reservation</label>
                            <select class="form-select" name="reservationFilter">
                                <option value="">All Orders</option>
                                <option value="with" selected="@(Model.ReservationFilter == "with")">With Reservation</option>
                                <option value="without" selected="@(Model.ReservationFilter == "without")">Without Reservation</option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <div class="btn-group w-100">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search me-1"></i> Apply
                                </button>
                                <a href="@Url.Action("UserDashboard")" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-1"></i> Clear
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Orders Cards Section -->
    <div class="row">
        <div class="col-12">
            <div class="section-header">
                <h4><i class="fas fa-history me-2"></i>My Orders</h4>
                <span class="badge">@Model.Orders.Count orders found</span>
            </div>

            @if (Model.Orders.Any())
            {
                <div class="orders-grid">
                    @foreach (var order in Model.Orders)
                    {
                        <div class="order-card">
                            <div class="order-header">
                                <div class="order-number">@order.OrderNo</div>
                                <div class="order-date">@order.OrderDate.ToString("MMM dd, yyyy")</div>
                            </div>

                            <div class="order-items">
                                @foreach (var item in order.OrderItems.Take(3))
                                {
                                    <div class="order-item">
                                        <span class="item-quantity">@item.Quantity</span>
                                        <span class="item-name">@item.ItemName</span>
                                        <span class="item-price">₱@((item.Quantity * item.UnitPrice).ToString("N2"))</span>
                                    </div>
                                }
                                @if (order.OrderItems.Count > 3)
                                {
                                    <div class="more-items">+@(order.OrderItems.Count - 3) more items</div>
                                }
                            </div>

                            <div class="order-details">
                                <div class="order-total">
                                    <strong>Total: ₱@order.TotalPrice.ToString("N2")</strong>
                                </div>

                                @if (order.TableReservation != null)
                                {
                                    <div class="table-reservation">
                                        <div class="table-image">
                                            @{
                                                var imagePath = order.TableReservation.TableNumber switch
                                                {
                                                    "T01" => "/images/table1.jpg",
                                                    "T02" => "/images/table2.jpg",
                                                    "T07" => "/images/table7.jpg",
                                                    "T03" => "/images/table3.jpg",
                                                    "T04" => "/images/table4.jpg",
                                                    "T08" => "/images/table8.jpg",
                                                    "T05" => "/images/table5.jpg",
                                                    "T06" => "/images/table6.jpg",
                                                    "T09" => "/images/table9.jpg",
                                                    "VIP1" => "/images/vip8.jpg",
                                                    "VIP2" => "/images/vip10.jpg",
                                                    _ => "/images/table1.jpg"
                                                };
                                            }
                                            <img src="@imagePath"
                                                 alt="Table @order.TableReservation.TableNumber"
                                                 onerror="this.style.backgroundColor='#f8f9fa'; this.alt='Table image not available';">
                                        </div>
                                        <div class="table-info">
                                            <strong>Table @order.TableReservation.TableNumber</strong>
                                            <small>@order.TableReservation.NumberOfGuests guests</small>
                                            <small>@order.TableReservation.ReservationDate.ToString("MMM dd") at @order.TableReservation.ReservationTime.ToString(@"hh\:mm")</small>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="no-reservation">
                                        <i class="fas fa-utensils"></i>
                                        <span>No table reservation</span>
                                    </div>
                                }
                            </div>

                            <div class="order-footer">
                                <div class="order-status status-@order.Status.ToLower()">
                                    @order.Status
                                </div>
                                <div class="order-actions">
                                    @if (order.Status == "Pending" || order.Status == "Confirmed")
                                    {

                                        <a href="@Url.Action("UserEdit", new { id = order.Id })" class="btn btn-outline-warning btn-sm">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>

                                        <form asp-action="CancelOrder" method="post" class="d-inline">
                                            <input type="hidden" name="id" value="@order.Id" />
                                            <button type="submit" class="btn btn-outline-danger btn-sm"
                                                    onclick="return confirm('Are you sure you want to cancel this order?')">
                                                <i class="fas fa-times"></i> Cancel
                                            </button>
                                        </form>
                                    }
                                    <a href="@Url.Action("Receipt", new { id = order.Id })" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-receipt"></i> Receipt
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="empty-orders">
                    <i class="fas fa-search fa-3x"></i>
                    <h5>No orders found</h5>
                    <p>Try adjusting your search or filter criteria.</p>
                    <a href="@Url.Action("UserDashboard")" class="btn btn-primary">Clear Filters</a>
                </div>
            }
        </div>
    </div>
</div>